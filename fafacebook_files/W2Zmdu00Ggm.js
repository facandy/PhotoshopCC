/*!CK:1048329898!*//*1446441581,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["eNyR5"]); }

__d('SearchAwarenessLearningNUX',['Arbiter','CSS','DOM','NavigationMessage','Run','SearchAwarenessDispatcher','SearchAwarenessWebConfig','SearchPivotType','SubscriptionsHandler','csx','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();function s(t){'use strict';this.core=t.getCore();this.view=this.core.view;this.debug=false;this.subscriptionsHandler=new p();this.showingNullState=true;this.setupComplete=false;this.setupSecondStepComplete=false;}s.prototype.enable=function(){'use strict';var t=this.core.getValue()!=null?this.core.getValue().toString():null;if(t!=null&&t.length>0)return;this.subscriptionsHandler.addSubscriptions(h.subscribe('SearchAwareness.triggerLearningNUX',(function(u,v){if(v.origin===o.LEARNING_NUX){this.setup();}else this.setupSecondStep();}).bind(this)),h.subscribe(k.NAVIGATION_BEGIN,(function(){this.disable();}).bind(this)));l.onLeave((function(){this.disable();}).bind(this));this.setup();};s.prototype.disable=function(){'use strict';this.teardown();};s.prototype.setup=function(){'use strict';if(this.setupComplete)return;var t=this.getHiddenAwarenessUnit(o.LEARNING_NUX),u=this.core.getValue()!=null?this.core.getValue().toString():null;if(t==null||u!=null&&u.length>0)return;this.config=JSON.parse(t.getAttribute('data-config'));if(this.config.ghost_text!=null){var v=j.scry(document.body,"._586i")[0];if(v){i.addClass(v,"_55me");v.setAttribute('data-ghost-text',this.config.ghost_text);}}this.nullState=j.create('div',{'class':"_3lie"},t);j.prependContent(this.view.getElement(),this.nullState);this.subscriptionsHandler.addSubscriptions(this.view.subscribe('render',this.onViewRender.bind(this)),this.view.subscribe('show',this.onViewShow.bind(this)),this.view.subscribe('hide',this.onViewHide.bind(this)),this.view.subscribe('filter',this.onViewFilter.bind(this)),this.view.subscribe('beforeSelect',this.onViewBeforeSelect.bind(this)));this.mask=j.create('div',{className:"_3lif"});j.appendContent(document.body,this.mask);this.showSecondStepAwarenessUnit();this.activationWindowTimer=setTimeout((function(){this.disable();}).bind(this),this.config.activation_window);this.setupComplete=true;};s.prototype.teardown=function(){'use strict';if(this.mask)i.removeClass(this.mask,"_3lih");i.removeClass(this.view.getElement(),"_3lii");i.removeClass(this.view.getElement(),"_3lij");i.removeClass(this.view.getElement(),"_55mf");i.removeClass(this.view.getElement(),"_55mg");i.removeClass(this.core.getElement(),"_55mh");if(this.debug)return;if(this.mask){j.remove(this.mask);this.mask=null;}if(this.nullState){j.remove(this.nullState);this.nullState=null;}if(this.secondStep){j.remove(this.secondStep);this.secondStep=null;}this.subscriptionsHandler.release();};s.prototype.setupSecondStep=function(){'use strict';if(this.setupSecondStepComplete||!this.setupComplete)return;var t=this.getHiddenAwarenessUnit(o.LEARNING_NUX_SECOND_STEP);if(t==null){this.setupSecondStepComplete=true;return;}this.secondStep=j.create('div',{className:"_3lig"},t);j.prependContent(this.view.getElement(),this.secondStep);this.setupSecondStepComplete=true;};s.prototype.getHiddenAwarenessUnit=function(t){'use strict';var u=j.scry(document.body,"._3lik"),v=undefined;for(var w=u,x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var z;if(x){if(y>=w.length)break;z=w[y++];}else{y=w.next();if(y.done)break;z=y.value;}var aa=z,ba=aa.getAttribute('data-origin');if(ba===t&&aa.firstChild!=null)v=aa;}if(v==null)return undefined;var ca=v.firstChild;j.remove(v);return ca;};s.prototype.onViewRender=function(){'use strict';i.conditionClass(this.view.getElement(),"_3lij",this.core.isNullState());};s.prototype.onViewShow=function(){'use strict';clearTimeout(this.activationWindowTimer);i.addClass(this.mask,"_3lih");i.addClass(this.view.getElement(),"_3lii");};s.prototype.onViewHide=function(){'use strict';this.disable();};s.prototype.onViewFilter=function(t,u){'use strict';var v=0;for(var w=0;w<u.results.length;w++){var x=u.results[w];if(x.type==='keyword'){v++;var y=x.uri.getQueryData();y[n.url_param_trigger_key]=this.config.aw_id;x.uri.setQueryData(y);}else x.unselectable=true;}var z=this.core.getValue()!=null?this.core.getValue().toString():null,aa=z!=null&&z.length>0&&z.length<3&&v<3;i.conditionClass(this.core.getElement(),"_55mh",aa);if((this.config.block_ta_entity_clicks==null||this.config.block_ta_entity_clicks===false)&&z!=null&&z.length>=1)i.addClass(this.view.getElement(),"_55mf");};s.prototype.onViewBeforeSelect=function(t,u){'use strict';if(this.blockedClick||this.config.block_ta_entity_clicks!==true)return true;if(u.selected.type!=='keyword'){this.blockedClick=true;i.addClass(this.view.getElement(),"_55mf");i.addClass(this.view.getElement(),"_55mg");setTimeout((function(){i.removeClass(this.view.getElement(),"_55mg");}).bind(this),5000);return false;}return true;};s.prototype.showSecondStepAwarenessUnit=function(){'use strict';m.triggerLearningNUX(o.LEARNING_NUX_SECOND_STEP,this.config.encoded_query,this.config.actor_id,this.config.story_id,this.config.global_share_id);};f.exports=s;},null);
__d("XBusinessProductDashboardNuxLogViewAsyncController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/products\/catalog\/welcome_nux\/view\/",{});},null,{});